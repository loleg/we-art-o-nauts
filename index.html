<script cdn='https://aframe.io/releases/0.8.2/aframe.min.js'
	src='js/aframe/aframe-v0.8.2.min.js'></script>
<script cdn="https://unpkg.com/aframe-text-geometry-component@0.5.1/dist/aframe-text-geometry-component.min.js"
	src='js/aframe-text-geometry-component.min.js'></script>
<script cdn="https://unpkg.com/..."
	src='js/aframe-html-shader/aframe-html-shader.min.js'></script>

<script cdn="https://fastcdn.org/Papa-Parse/4.1.2/papaparse.min.js"
	src='js/papaparse.min.js'></script>
<!-- <script src='https://code.responsivevoice.org/responsivevoice.js'></script> -->

<script language="JavaScript">
var url = 'data/Carpet Dates 2 - od1.csv';
// var url = window.prompt('Enter URL to a Timeline.js spreadsheet, or try our Allianzteppich demo:', 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTqho8_04F-mr4wQp1i5AOuokgzTm2PQc2Gk5L_ZEnXsrvpPc0QXp8NSy1QzWSvulbJ17TncU4FUNCI/pub?output=csv');

const HELIX_DISTANCE = 16;

var ix = 0, timeline = [];

function createScene() {
	var sceneEl = document.querySelector('a-scene');
	var skyBox = sceneEl.querySelector('#sky');
	// var carpetPlane = sceneEl.querySelector('#carpetPlane');
	var theBody = document.getElementsByTagName('body')[0];

	// console.log(timeline);
	timeline.forEach(function(entry, i) {

		// var elText = document.createElement('a-entity');
		// elText.setAttribute('rotation', '0 0 5');
		// elText.setAttribute('position', getHelixPosition(i));
		// elText.setAttribute('text-geometry', {
		// 	'value': entry["Display Date"],
		// 	'font': '#dawningFont',
		// 	'curveSegments': 12,
		// 	'size': 1,
		// 	'height': 0
		// });

		var elText = document.createElement('div');
		var elTextID = 'el_timeline' + i;
		elText.setAttribute('id', elTextID);
		elText.setAttribute('class', 'infoBox');
		var elP = document.createElement('p');
		elP.setAttribute('style', 'font-size:100px');
		var elI = document.createElement('img');
		elI.setAttribute('src', entry["Media"]);
		var elT = document.createTextNode(entry["Display Date"])
		elP.appendChild(elT);
		elP.appendChild(elI);
		elText.appendChild(elP);
		theBody.appendChild(elText);

		var helix = getHelix(i, timeline.length, HELIX_DISTANCE);
		var rdeg = {
			'x': THREE.Math.radToDeg(helix.rotation.x),
			'y': THREE.Math.radToDeg(helix.rotation.y),
			'z': THREE.Math.radToDeg(helix.rotation.z)
		};

		var elPlane = document.createElement('a-plane');
		elPlane.setAttribute('position', helix.position);
		elPlane.setAttribute('rotation', rdeg);
		elPlane.setAttribute('width', 5);
		elPlane.setAttribute('height', 4);
		elPlane.setAttribute('color', '#FFFFFF');
		elPlane.setAttribute('material', 'shader: html; target: #' + elTextID);
	// });
	// elPlane.setAttribute('text-geometry', 'value', timeline[ix]["Display Date"]);
	sceneEl.appendChild(elPlane);

	// diff = 2018 - parseInt(timeline[ix]["Year"]);
	// dist = -40 + 16 * diff/500;

	// carpetPlane.setAttribute('position', '0 0 ' + dist);
	// carpetPlane.setAttribute('material', 'opacity', diff/500);
	// carpetPlane.setAttribute('src', timeline[ix]["Media"]);
	//
	// responsiveVoice.speak(timeline[ix]["Headline"]);

});  //- forEach
} //- createScene

// A bit of math a day keeps the bocktor away
function getHelix(i, total, distance) {
	helix = new THREE.Object3D();
  phi = Math.PI + i * Math.PI * 2 / total;
  helix.position.x = distance * Math.sin(phi);
	helix.position.z = distance * Math.cos(phi);
  helix.position.y = 0; //- (i * 8) + HELIX_DISTANCE/2;
	vector = new THREE.Vector3();
  vector.x = 0; vector.y = 0; vector.z = 0;
  helix.lookAt(vector);
	return helix;
}

Papa.parse(url, {
	download: true, header: true,
	complete: function(results)
	{
		if (results.errors.length) console.warn(results.errors);

		// Sort the timeline
		timeline = results.data.sort(function(a, b) {
		  return parseInt(a["Year"]) - parseInt(b["Year"]);
		});

		timeline.push({
			'Display Date': 'Start',
			'Headline': 'Welcome, we-art-o-naut ~ hear me out',
			'Text': 'Here are some instructions to get you started'
		});
		timeline.reverse();

		// Start setting up the scene
		createScene();
	}
});

</script>

<body>
<a-scene>

	<a-assets>
		<img id="sky" src="data/WqlqEkq.jpg" crossorigin="anonymous" />
		<img id="carpet" src="data/DIG-4902_DEP-65.jpg" crossorigin="anonymous">
		<a-asset-item id="dawningFont" src="https://cdn.glitch.com/c719c986-c0c5-48b8-967c-3cd8b8aa17f3%2FdawningOfANewDayRegular.typeface.json?1490305922844"></a-asset-item>
	</a-assets>

	<a-entity id="theLight" light="color: white; intensity: 0.5" position="-5 5 15"></a-entity>
	<a-entity light="color: white; type: ambient;"></a-entity>

	<a-sky src="#sky" rotation="0 0 0" radius='100'></a-sky>

	<a-camera-static/>

</a-scene>
</body>

<style type="text/css">
body { margin: 0px; overflow: hidden; z-index: 0;
	background:black;  }
.infoBox { width: 600px; height: 400px; position: fixed; left: 0; top: 0; z-index: -1; overflow: hidden;
	background:white; }
.infoBox p {
	font-weight:bold; font-family:sans-serif;
 	margin: 0px; }
.infoBox img {
	width: 100%;
}
</style>
